\usepackage{listings}
\definecolor{vccOutColor}{rgb}{0.0,0.0,0.3}
\definecolor{vccDotsColor}{rgb}{0.3,0.3,0.3}
\lstloadlanguages{C}
\lstdefinelanguage{VCC}[ANSI]{C}{%
  morekeywords={spec,axiom,requires,ensures,returns,reads,writes,%
                old,speconly,%
                VOID,BOOLEAN,%
                assert,assume,invariant,result,forall,exists,expose,skinny_expose,wrap,unwrap,atomic,%
		unchecked,bv_lemma,
                % New stuff:
                NULL,
		\true,\false,\relaxed,\relaxable,\valid,\proper,\old,\writable,\thread_local,%
                \object,},
  moredelim=[is][\fontfamily{cmtt}\selectfont\textcolor{vccOutColor}]{/*`}{`*/},
  morecomment=[is]{//--}{//--},
}

\lstnewenvironment{VCC}[1][]{%
  \lstset{%
    floatplacement={tbp},
    captionpos=b,language=VCC,#1
    }}{}%

\lstnewenvironment{VCC2}[1][0.45]
    {\global\let\lst@intname\@empty
     \gdef\lst@sample{}%
    \setbox0=\hbox\bgroup
         \setkeys{lst}{floatplacement={tbp},captionpos=b,language=VCC}
         }
    {\egroup%
      \noindent\begin{minipage}{#1\linewidth}\hbox to\linewidth{\box0\hss}\end{minipage}}

\def\vcc{%
    \lstinline[language=VCC]}

\newcommand\vccInput[2][]{{\lstset{language=VCC}\lstinputlisting[#1]{#2}}}
\newcommand\vccInputSC[2][]{{\lstset{language=VCC,morecomment=[is]{/*}{*/}}\lstinputlisting[#1]{#2}}}
