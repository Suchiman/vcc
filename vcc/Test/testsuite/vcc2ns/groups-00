#include <vcc.h>

struct S {

  def_group(G)

  in_group(G) int a;
  int b;
  in_group(G) int c;
  
  invariant(keeps((struct S::G *)this))
};

void writeNonGroupField(struct S *s)
  maintains(wrapped(s))
  writes(s)
{
  unwrap(s);
  s->b = 10;
  wrap(s);
}

void writeGroupFieldShouldFail(struct S *s)
  maintains(wrapped(s))
  writes(s)
{
  unwrap(s);
  s->a = 10;
  wrap(s);
}

void writeGroupFieldShouldFail2(struct S *s)
  maintains(wrapped(s))
  writes(s)
{
  unwrap(s);
  s->c = 10;
  wrap(s);
}

void writeGroupField(struct S *s)
  maintains(wrapped(s))
  writes(s)
{
  unwrap(s);
  unwrap((struct S::G *)s);
  s->a = 10;
  wrap((struct S::G *)s);
  wrap(s);
}

`
Verification of S#adm succeeded.
Verification of writeNonGroupField succeeded.
Verification of writeGroupFieldShouldFail failed.
testcase(28,3) : error VC8507: Assertion 's->a is writable' did not verify.
Verification of writeGroupFieldShouldFail2 failed.
testcase(37,3) : error VC8507: Assertion 's->c is writable' did not verify.
Verification of writeGroupField succeeded.
`
