#include <vcc.h>

#ifdef VERIFY 
typedef int MAP[int];
#endif

struct S {
  int i;
  spec(MAP m;)
};

spec(ispure MAP MyLambda(MAP oldMap, int j)
  ensures(result == lambda(int n; true; n == j ? 0 : oldMap[n]));
)

void foo(struct S *s, int j)
  writes(s)
  maintains(wrapped(s))
  ensures(forall(int i; s->m[i] == MyLambda(old(s->m), j)[i]))
{
  expose(s) {
    spec(s->m[j] = 0;)
  }
}
`
Verification of foo succeeded.
`
