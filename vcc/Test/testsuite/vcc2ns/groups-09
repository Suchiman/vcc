#include <vcc.h>

struct S {

  def_group(G)
  inv_group(G, this->a == this->c)
  in_group(G) int a;
  int b;
  in_group(G) int c;
  
  invariant(keeps(this::G))
};

void maintainGroupInvariant(struct S *s)
  maintains(wrapped(s))
  writes(s)
{
  int tmp;
  unwrap(s);
  unwrap(s::G);
  tmp = s->a;
  s->a = s->c;
  s->c = tmp;
  wrap(s::G);
  wrap(s);
}

void destroyGroupInvariantShouldFail(struct S *s)
  maintains(wrapped(s))
  writes(s)
{
  //indomain((struct _S::G *)s, s);
  unwrap(s);
  unwrap(s::G);
  s->a = 10;
  s->c = 11;
  wrap(s::G);
  wrap(s);
}
`
Verification of S#adm succeeded.
Verification of S##G#adm succeeded.
Verification of maintainGroupInvariant succeeded.
Verification of destroyGroupInvariantShouldFail failed.
testcase(37,13) : error VC8014: invariant(__this->a == __this->c) of S##G fails on wrap.
testcase(6,36) : error VC9599: (related information) location of the invariant.
`
