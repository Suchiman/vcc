#include <vcc.h>

struct B {
  int y;
};

struct A {
  int x;
  struct B *b;

  invariant(keeps(this->b))
};

void update(struct A *a)
  writes(a);

void bar(struct A *a, struct A *b)
  requires(wrapped(a) && wrapped(b) && a != b)
  writes(a,b)
{
  assert(in_domain(a,a));
  assert(in_domain(a->b,a));
  update(b);
  assert(a->b->y == old(a->b->y));
}
`
Verification of A#adm succeeded.
Verification of bar succeeded.
`
