`/newsyntax
#include <vcc2test.h>


_(logic bool fresh_object(\object ptr) = \object_root(ptr) && \mutable(ptr) && \fresh(ptr))

void *alloc(unsigned __int64  sz)
  _(ensures fresh_object(_(blob sz)(\result)))
  ;

struct A {
  int x , y;
};
struct B {
  struct A a1;
  struct A a2;
  int x;
};

void mfree(void *p, unsigned __int64 sz)
  _(writes \extent(_(blob sz)p))
  ;

void f2()
{
  struct B * b = _(unblobify) (struct B*)alloc(sizeof(struct B));
  b->x = 20;
  b->a1.x = 10;
  b->a2.y = 20;
  mfree(_(blobify)b, sizeof(*b));
}

void f2_fail1()
{
  struct B * b = _(unblobify) (struct B*)alloc(sizeof(struct B));
  _(wrap &b->a1)
  mfree(_(blobify)b, sizeof(*b));
}

void f2_fail2()
{
  struct B * b = _(unblobify) (struct B*)alloc(sizeof(struct B) - 1);
}

void f2_fail3()
{
  struct B * b = _(unblobify) (struct B*)alloc(sizeof(struct B) + 1);
}
`
Verification of f2 succeeded.
Verification of f2_fail1 failed.
testcase(36,33) : error VC8507: Assertion 'extent(b) is writable' did not verify.
Verification of f2_fail2 failed.
testcase(41,45) : error VC8507: Assertion '_(blob 20) ((struct B*)alloc(sizeof(struct B) - 1)) is writable' did not verify.
Verification of f2_fail3 failed.
testcase(46,45) : error VC8507: Assertion '_(blob 20) ((struct B*)alloc(sizeof(struct B) + 1)) is writable' did not verify.
`
