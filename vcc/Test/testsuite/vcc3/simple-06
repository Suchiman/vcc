#include <vcc2.h>

struct A {
  int f;
  volatile int g;
};

void bar(struct A *a)
  maintains(wrapped(a))
{
  atomic(a) {
    a->g = 3;
  }
}

void foo()
{
  struct A a;

  a.f = 1;
  a.g = 2;
  wrap(&a);
  assert(a.f == 1 && a.g == 2);
  bar(&a);
  assert(a.f == 1);
  assert(a.g == 2); // should fail
  unwrap(&a);

}
`
Verification of bar succeeded.
Verification of foo failed.
testcase(26,12) : error VC9500: Assertion 'a.g == 2' did not verify.
`
