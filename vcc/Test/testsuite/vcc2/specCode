#include "vcc.h"

spec(int a = 5; 
     int b = 10; 
     int foo() { }; 
     void bar() { }; 
     struct S { int a; int b; }; 
)

struct T {
  spec(int a; int b;)
  int c;
  invariant(a+b == c)
};
`
Verification of T#adm succeeded.
Verification of foo succeeded.
Verification of bar succeeded.
`
#include <vcc.h>

void foo() {}

void test() {
  spec(foo();)
} 
`
testcase(6,19) : warning VC9313: [possible unsoundness]: call to impure implementation function 'foo' from specification code
Verification of foo succeeded.
Verification of test succeeded.
`
#include <vcc.h>

int ispure foo(int i);

void test() {
  spec(int i = foo(5);)
} 
`
Verification of test succeeded.
`
#include "vcc.h"

spec(struct X1 {
    struct { unsigned Y; };
    unsigned Z;
};)

spec(struct X1 foo(unsigned x) ensures(result.Y == x)
{
  struct X1 x1;
  x1.Y = x;
  return x1;

}
)
struct X2 {
    struct { unsigned Y; };
    unsigned Z;
};

struct X2 foo(unsigned x) ensures(result.Y == x)
{
  struct X2 x2;
  x2.Y = x;
  return x2;
}
`
Verification of foo#overload#struct_X1#spec_uint32_t succeeded.
Verification of foo#overload#struct_X2#uint32_t succeeded.
`
__specification(void foo();)

void bar() {
	foo();
}
`
testcase(4,2) : warning VC9301: [possible unsoundness]: access to specification function 'foo' within non-specification code
Verification of bar succeeded.
`
#include "vcc.h"


struct S {
  int a;
  spec(int b;)
};

struct T {
  int a;
  struct S ^s;
  invariant(keeps(s))
};

void foo(spec(struct S ^p)) 
  writes(extent(p))
  requires(mutable(p))
{
  p->a = 5;
  p->b = 3;
  spec(p->a = 7;)
  spec(p->b = 10;)
}

void bar(struct T *t)
  writes(t)
  requires(wrapped(t))
{
  unwrap(t);
  unwrap(t->s);
  t->s->a = 5;
}
`
testcase(11,10) : warning VC9301: [possible unsoundness]: non-specification field 's' has specification type 'struct S^'
testcase(19,3) : warning VC9301: [possible unsoundness]: write to specification parameter 'p' from non-specification code
testcase(20,3) : warning VC9301: [possible unsoundness]: write to specification field 'b' from non-specification code
Verification of T#adm succeeded.
Verification of foo succeeded.
Verification of bar succeeded.
`
#include <vcc.h>

typedef struct Foo {
int x;
} Foo;

void foo() {
spec(Foo f;)
f.x = 3;
}
`
testcase(9,1) : warning VC9301: [possible unsoundness]: write to specification variable 'f' from non-specification code
Verification of foo succeeded.
`