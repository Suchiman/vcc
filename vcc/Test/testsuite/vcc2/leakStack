`/newsyntax
#include "vcc.h"

struct S { int x, y; };
struct T { int a, b; };

struct S *foo()
    _(ensures \wrapped(\result))
    _(ensures \fresh(\result))
    _(ensures \result->x==42)
{
    struct S s;
    s.x = 42;
    _(wrap &s)
    return &s;
}

struct T *xyz() 
    _(ensures \wrapped(\result))
    _(ensures \fresh(\result))
    _(ensures \result->a==42)
{
    struct T t;
    t.a = 42;
    _(wrap &t)
    return &t;
}

void bar() {
    struct S *a, *b;
    struct T *t;
    a = foo();
    _(assert a \in \domain(a))
    t = xyz();
    _(assert a->x==42)
}
`
Verification of foo failed.
testcase(6,8) : error VC9502: Call 'stack_free(&s)' did not verify.
testcase(0,0) : error VC9599: (related information) Precondition: 'the extent of the object being reclaimed is mutable'.
Verification of xyz failed.
testcase(17,8) : error VC9502: Call 'stack_free(&t)' did not verify.
testcase(0,0) : error VC9599: (related information) Precondition: 'the extent of the object being reclaimed is mutable'.
Verification of bar succeeded.
`
`/newsyntax
#include <vcc.h>

struct S {
  int a;
  int b;
};

void foo() {
  struct S s;
  _(wrap &s)
  _(unwrap &s)
}

void fooShouldFail() {
  struct S s;
  _(wrap &s)
}

void bar() {
  int i;
  int *p = &i;
}

`
Verification of foo succeeded.
Verification of fooShouldFail failed.
testcase(14,1) : error VC9502: Call 'stack_free(&s)' did not verify.
testcase(0,0) : error VC9599: (related information) Precondition: 'the extent of the object being reclaimed is mutable'.
Verification of bar succeeded.
`
`/newsyntax
#include <vcc.h>

void foo() {
  int a[5];
}


void fooShouldFail() {
  int a[5];
  _(wrap (int[5])a)
}

void bar() {
  int a[5];
  _(wrap (int[5])a)
  _(unwrap (int[5])a)
}
`
Verification of foo succeeded.
Verification of fooShouldFail failed.
testcase(9,9) : error VC9502: Call 'stack_free(&res__vcc_stack_alloc#2)' did not verify.
testcase(0,0) : error VC9599: (related information) Precondition: 'the extent of the object being reclaimed is mutable'.
Verification of bar succeeded.
`
`/newsyntax
#include <vcc.h>

struct S { int a; };

void foo() {
  struct S a[10];
}

void fooShouldFail() {
  struct S a[10];
  _(wrap &a[1])
}


void bar() {
  struct S a[10];
  _(wrap &a[1])
  _(unwrap &a[1])
}
`
Verification of foo succeeded.
Verification of fooShouldFail failed.
testcase(10,14) : error VC9502: Call 'stack_free(&res__vcc_stack_alloc#2)' did not verify.
testcase(0,0) : error VC9599: (related information) Precondition: 'the extent of the object being reclaimed is mutable'.
Verification of bar succeeded.
`
`/newsyntax
#include <vcc.h>

void foo() {
  int i;

  for (i = 0; i < 1024; i++) 
  {
    int j;
    int *p = &j;
    *p = i; 
  }
}

void bar() {
  int i;
  int j;
  for (i = 0; i < 1024; i++) 
  {
    int a[100];
    j = i; 
  }
}


struct S { int a; };

void baz() {
  int i;
  int j;
  for (i = 0; i < 1024; i++) 
  {
    struct S s;
    struct S *p = &s;
    j = i; 
  }
}
`
Verification of foo succeeded.
Verification of bar succeeded.
Verification of baz succeeded.
`
`/newsyntax
#include <vcc.h>

#include <vcc.h>

struct S
{
  int dummy;
};

void localShouldFail(void) {
  struct S *a;
  {
    struct S j;
    a = &j;
    _(wrap &j)
  }
  _(unwrap a)
}


void localShouldFailToo(void) {
  struct S *a;
  {
    struct S j;
    a = &j;
  }
  a->dummy = 5;
}
`
Verification of localShouldFail failed.
testcase(10,1) : error VC9502: Call 'stack_free(&j)' did not verify.
testcase(0,0) : error VC9599: (related information) Precondition: 'the extent of the object being reclaimed is mutable'.
Verification of localShouldFailToo failed.
testcase(27,3) : error VC8507: Assertion 'a->dummy is writable' did not verify.
`
